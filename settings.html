<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="  #30334B">
    <meta name="apple-mobile-web-app-status-bar-style" content="  #30334B">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Jacquarda+Bastarda+9&family=Poppins:ital,wght@0,400;1,300;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/settings.css">
</head>
<body class="hydrated">
    <!-- App Header -->
    <div class="app-header">
        <div class="back-button">
            <a href="dashboard.html">
                <<
            </a>
        </div>
        <h3 class="page-title">Settings</h3>
        <div class="notification-icon">
            <img src="./css/images/Alarm.png" alt="Notifications">
            <span class="notification-badge">4</span>
        </div>
    </div>

    <!-- App Capsule -->
    <div class="app-capsule">
        <!-- Profile Section -->
        <div class="profile-section">
            <div class="profile-img">
                <img src="./css/images/fun-3d-cartoon-robot-dancing 1.png" alt="User Profile">
                <!-- <div class="camera-icon">
                    <img src="./css/images/SLR Camera.png" alt="Camera">
                </div> -->
            </div>
        </div>

        <!-- Settings Sections -->
        <div class="settings-section">
            <!-- Theme Section -->
             <p>Theme</p>
            <div class="setting-item">
                <span class="setting-label">Dark Mode</span>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div>

            <!-- Notifications Section -->
            <p>Notification</p>
            <div class="setting-item">
                <span class="setting-label">Payment Alert</span>
                <p class="setting-description"></p>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="setting-item">
                <span class="setting-label">Notification Sound</span>
                <a href="#" class="setting-action">Beep</a>
            </div>

            <!-- Profile Settings -->
            <p>Profile Setting</p>
            <div class="setting-item">
                <span class="setting-label">Change Username</span>
                <a href="#" id="openUsernameModal" class="setting-action">→</a>
            </div>
            <!-- <div class="setting-item">
                <span class="setting-label">Address</span>
                <a href="#" id="openAddressModal" class="setting-action">Edit</a>
            </div> -->
            <div class="setting-item">
                <span class="setting-label">Private Profile</span>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div>
            <p>Security</p>
            <div class="setting-item">
                <span class="setting-label">Update Password</span>
                <a href="#" id="openPasswordModal" class="setting-action">→</a>
            </div>
            
            <div class="setting-item">
                <span class="setting-label">2 Step Verification</span>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div>
            <a href="index.html" style="text-decoration: none; color: red;">
                <div class="setting-item">
                    <span class="setting-label" >Log out</span>
                    <!-- <label class="switch">
                        <input type="checkbox">
                        <span class="slider round"></span>
                    </label> -->
                </div>
            </a>
           
        </div>

        <!-- Change Username Modal -->
<div id="usernameModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Change Username</h2>
        <form id="changeUsernameForm">
            <input type="text" id="newUsername" placeholder="Enter new username" required />
            <button type="submit">Save</button>
        </form>
    </div>
</div>

<!-- Update Address Modal -->
<div id="addressModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit Address</h2>
        <form id="updateAddressForm">
            <textarea id="newAddress" placeholder="Enter your address"></textarea>
            <button type="submit">Save</button>
        </form>
    </div>
</div>

<!-- Update Password Modal -->
<div id="passwordModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Update Password</h2>
        <form id="updatePasswordForm">
            <input type="password" id="oldPassword" placeholder="Old Password" required />
            <input type="password" id="newPassword" placeholder="New Password" required />
            <button type="submit">Update Password</button>
        </form>
    </div>
</div>

    </div><br><br><br><br>

    <!-- App Bottom Menu -->
    <div class="bottom-nav">
        <ul class="nav-links">
            <li><a href="dashboard.html"><img src="./css/images/Control Panel.png" alt="Home Icon"><span>Home</span></a></li>
           
            <li><a href="cards.html"><img src="./css/images/Bank Cards.png" alt="cards" ><span>Cards</span></a></li>
            <li><a href="settings.html"><img src="./css/images/Settings.png" alt="Settings" ><span>Settings</span></a></li>
            <li><a href="chatbot.html"><img src="./css/images/WeChat.png" alt="Chat"><span>Chat</span></a></li>
        </ul>
    </div>

    <script>
        // Check if dark mode is enabled in localStorage on page load
window.addEventListener('DOMContentLoaded', () => {
    const darkModeCheckbox = document.querySelector('.setting-item input[type="checkbox"]');
    
    // Apply dark mode if previously enabled
    if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
        if (darkModeCheckbox) {
            darkModeCheckbox.checked = true;  // Set checkbox to checked if dark mode was enabled
        }
    }

    // Toggle dark mode when the checkbox is clicked
    if (darkModeCheckbox) {
        darkModeCheckbox.addEventListener('change', () => {
            if (darkModeCheckbox.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'disabled');
            }
        });
    }
});


document.addEventListener('DOMContentLoaded', () => {
    // Modal elements
    const usernameModal = document.getElementById('usernameModal');
    const addressModal = document.getElementById('addressModal');
    const passwordModal = document.getElementById('passwordModal');

    // Open buttons
    const openUsernameModal = document.getElementById('openUsernameModal'); // Change Username
    const openAddressModal = document.getElementById('openAddressModal'); // Edit Address
    const openPasswordModal = document.getElementById('openPasswordModal'); // Update Password

    // Close buttons
    const closeButtons = document.querySelectorAll('.close');

    // Functions to open and close modals
    const openModal = (modal) => {
        modal.style.display = 'block';
    };

    const closeModal = (modal) => {
        modal.style.display = 'none';
    };

    // Open modals
    if (openUsernameModal) {
        openUsernameModal.addEventListener('click', (e) => {
            e.preventDefault();
            openModal(usernameModal);
        });
    }

    if (openAddressModal) {
        openAddressModal.addEventListener('click', (e) => {
            e.preventDefault();
            openModal(addressModal);
        });
    }

    if (openPasswordModal) {
        openPasswordModal.addEventListener('click', (e) => {
            e.preventDefault();
            openModal(passwordModal);
        });
    }

    // Close modals
    closeButtons.forEach((button) => {
        button.addEventListener('click', () => {
            const modal = button.closest('.modal');
            closeModal(modal);
        });
    });

    // Close modal when clicking outside of the modal content
    window.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
            closeModal(e.target);
        }
    });
});

// Change Username
document.getElementById('changeUsernameForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const newUsername = document.getElementById('newUsername').value;
    const email = localStorage.getItem('username');

    try {
        const response = await fetch('/api/update-username', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, newUsername }),
        });

        const data = await response.json();
        if (data.success) {
            alert('Username updated successfully!');
            modals.username.style.display = 'none';
        } else {
            alert(data.message || 'Failed to update username.');
        }
    } catch (error) {
        console.error('Error updating username:', error);
    }
});

// Update Address
document.getElementById('updateAddressForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const newAddress = document.getElementById('newAddress').value;
    const email = localStorage.getItem('username');

    try {
        const response = await fetch('/api/update-address', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, newAddress }),
        });

        const data = await response.json();
        if (data.success) {
            alert('Address updated successfully!');
            modals.address.style.display = 'none';
        } else {
            alert(data.message || 'Failed to update address.');
        }
    } catch (error) {
        console.error('Error updating address:', error);
    }
});

// Update Password
document.getElementById('updatePasswordForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const oldPassword = document.getElementById('oldPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const email = localStorage.getItem('username');

    try {
        const response = await fetch('/api/update-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, oldPassword, newPassword }),
        });

        const data = await response.json();
        if (data.success) {
            alert('Password updated successfully!');
            modals.password.style.display = 'none';
        } else {
            alert(data.message || 'Failed to update password.');
        }
    } catch (error) {
        console.error('Error updating password:', error);
    }
});

    </script>
</body>
</html>
