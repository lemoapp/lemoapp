<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/dashboard.css">
    <meta name="theme-color" content="  #30334B">
    <meta name="apple-mobile-web-app-status-bar-style" content="  #30334B">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Lemoapp</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Jacquarda+Bastarda+9&family=Poppins:ital,wght@0,400;1,300;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="body-container">
        <div class="container">
            <nav>
                <button><img src="./css/images/menu button.png" alt=""></button>
                <div class="logo"><img src="css/images/lemo logo.png" alt=""></div>
                <div class="nav-items"><img src="css/images/Alarm.png" alt=""></div>
            </nav>
    
    
            <div class="space">
    
            </div>
    
    
            <div class="container1">
                <div class="top">
                    <p>
                        Total Balance
                    </p>
                    <div class="balance">
                        <p  id="balance">$ 0.00</p>
                        <button id="depositButton">+</button>
                    </div><br>
                    <hr style="border-color: #e2effa;">
                </div>
                <div class="bottom">
                    
                    <div class="withdraw">
                        <button onclick="window.location.href='send.html';">>></button>
                        <label style="margin-left: 12px;">Send</label>
                    </div>
                    
                    <div class="withdraw">
                        <button style="background-color: rgb(29, 213, 127);">C</button>
                        <label style="margin-left: 10px;">Cards</label>
                    </div>
                    <div class="withdraw">
                        <button style="background-color: rgb(243, 186, 64);">E</button>
                        <label>Exchange</label>
                    </div>
                </div><br>
            </div>
        </div>
        <section class="second"><br><br><br><br><br><br>
              <div class="entries">
                <div class="tabs1">
                    <div class="tab">
                        <p>Income</p>
                        <div class="amount"  id="income" style="color: rgb(29, 213, 127)">
                            $ 0.00
                        </div>
                    </div>
                    <div class="tab">
                        <p>Expenses</p>
                        <div class="amount" id="expenses" style="color: rgb(243, 64, 91);">
                            $ 0.00
                        </div>
                    </div>
                </div>
                <div class="tabs1">
                    <div class="tab">
                        <p>Total Bills</p>
                        <div class="amount"  id="totalBills">
                            $ 0.00
                        </div>
                    </div>
                    <div class="tab">
                        <p>Savings</p>
                        <div class="amount" id="savings">
                            $ 0.00
                        </div>
                    </div>
                </div>
              </div>

              <div class="slideshow-container">
                <!-- Slides -->
                <div class="mySlides fade">
                    <img src="./css/images/card1.png" alt="Item 1">
                </div>
                <div class="mySlides fade">
                    <img src="./css/images/card2.png" alt="Item 2">
                </div>
                <div class="mySlides fade">
                    <img src="./css/images/card3.png" alt="Item 3">
                </div>
                <div class="mySlides fade">
                    <img src="./css/images/card4.png" alt="Item 4">
                </div>
        
                <!-- Indicators/Dots -->
                <div class="dots-container">
                    <span class="dot" onclick="currentSlide(1)"></span> 
                    <span class="dot" onclick="currentSlide(2)"></span> 
                    <span class="dot" onclick="currentSlide(3)"></span> 
                    <span class="dot" onclick="currentSlide(4)"></span> 
                </div>
            </div>

              <div class="container2">
                <div class="top">
                    <h4>Transactions</h4>
                    <a href="transactions.html">View all</a>
                </div>

                
                <div class="transactions"></div>
              </div> 

              


              <div class="container3">
                <div class="top">
                    <h4>My Cards</h4>
                    <a href="">View all</a>
                </div>
                <div class="cards">
                    <div class="card1">
                       <div class="top">
                        <div class="logo"><img src="css/images/lemo logo.png" alt=""></div>
                       <a href="">. . .</a>
                       </div>

                       <div class="mid">
                        <p>CARD NUMBER</p>
                        <div class="value">
                            ..... 0352
                        </div>
                       </div>

                       <div class="bottom">
                        <p>EXPIRING</p>
                        <div class="value">
                            12/26
                        </div>
                       </div>

                        
                    </div>
                </div>
              </div>
        </section>

        <section class="third">
            <div class="savings">
                <h4>Start saving</h4>

                <div class="savings-section">
                    <div class="animated-background">
                      <div class="content">
                        <h4 class="headline">Start Saving for a Brighter Tomorrow!</h4>
                        <p class="tagline">Set goals, save effortlessly, and watch your wealth grow.</p>
                        <button class="cta">Start Saving Now</button>
                      </div>
                      <img src="./css/images/rb_13529.png" alt="Piggy Bank" class="animation">
                    </div>
                  </div>
                  
              </div>
        </section>
        
            <div class="news-section">
                
              </div>


              
              </div><br><br><br><br><br>

    </div>

    <!-- Deposit Overlay -->
    <div id="depositOverlay" class="overlay">
        <div class="overlay-content">
            <button id="closeOverlay" class="close-button">X</button>
            <h4 style="color: white;">Deposit Options</h4>
            <div class="option" id="buyDollarOption">
                <h4>Fund Account with fiat money</h4>
                <p>USD</p>
            </div>
            <div class="option" id="depositCryptoOption">
                <h4>Deposit Crypto</h4>
                <p>Already have crypto? Deposit directly.</p>
            </div>
            <em>
                We recommend that you use a secure and reliable payment method to ensure a smooth transaction.
            </em>
        </div>
    </div>

    

    <div class="bottom-nav">
        <ul class="nav-links">
            <li><a href="main-page.html"><img src="./css/images/Control Panel.png" alt="Home Icon"><span>Home</span></a></li>
            <li><a href="chatbot.html"><img src="./css/images/Continuous Mode.png" alt="pages" ><span>Pages</span></a></li>
            <li><a href="wallet.html"><img src="./css/images/Bank Cards.png" alt="cards" ><span>Cards</span></a></li>
            <li><a href="settings.html"><img src="./css/images/Settings.png" alt="Settings" ><span>Settings</span></a></li>
            <li><a href="assets.html"><img src="./css/images/WeChat.png" alt="Chat"><span>Chat</span></a></li>
        </ul>
    </div>
<script src="java.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const email = localStorage.getItem('username'); // Get email from localStorage

    if (!email) {
        alert('User not logged in');
        return;
    }

    try {
        // Fetch the user data (balance, income, expenses, etc.)
        const userResponse = await fetch(`/api/dashboard?email=${email}`);
        const userData = await userResponse.json();

        if (userResponse.ok) {
            // Update balance, income, etc.
            document.getElementById('balance').textContent = `$ ${userData.data.balance.toFixed(2)}`;
            document.getElementById('income').textContent = `$ ${userData.data.income.toFixed(2)}`;
            document.getElementById('expenses').textContent = `$ ${userData.data.expenses.toFixed(2)}`;
            document.getElementById('totalBills').textContent = `$ ${userData.data.total_bills.toFixed(2)}`;
            document.getElementById('savings').textContent = `$ ${userData.data.savings.toFixed(2)}`;
        }

        // Fetch the most recent transactions
        const transactionsResponse = await fetch(`/api/transactions?email=${email}`);
        const transactionsData = await transactionsResponse.json();

        if (transactionsResponse.ok) {
            const transactionsContainer = document.querySelector('.transactions');
            transactionsContainer.innerHTML = ''; // Clear any previous transaction entries

            // Check if there are no transactions
            if (transactionsData.data.length === 0) {
                transactionsContainer.innerHTML = '<p style="color: #49af00; font-weight: bold; text-align: center; margin-top: 4rem;">No transactions yet!</p>';
            } else {
                // Populate the transactions container with the fetched transactions
                transactionsData.data.forEach(transaction => {
                    // Ensure that transaction.amount is a number
                    const amount = Number(transaction.amount); // Convert amount to a number
                    const formattedAmount = !isNaN(amount) ? amount.toFixed(2) : 'Invalid amount'; // Format amount with 2 decimals if valid

                    // Handle the transaction date, ensuring it is properly formatted
                    const transactionDate = new Date(transaction.date).toLocaleDateString();

                    const transactionElement = document.createElement('div');
                    transactionElement.classList.add('transaction');
                    transactionElement.innerHTML = `
                        <div class="left">
                            <img src="css/images/Checkmark.png" alt="">
                            <div class="details">
                               <h4>${transaction.transferType}</h4>
                                <p>Registered</p>
                            </div>
                        </div>
                        <div class="right">
                            <p>${amount > 0 ? '' : ''} $${formattedAmount}</p>
                            <h5>${transactionDate}</h5>
                        </div>
                    `;
                    transactionsContainer.appendChild(transactionElement);
                });
            }
        } else {
            alert(transactionsData.message || 'Failed to fetch transactions');
        }

    } catch (error) {
        console.error('Error fetching user details or transactions:', error);
        alert('An error occurred while fetching your data. Please try again later.');
    }
});
</script>
</body>
</html>